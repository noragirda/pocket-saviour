<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ServEase – Task 2: Search & Compare Plumbers (Mobile)</title>
<style>
  /* ===== Tokens (Soft Neutral) ===== */
  :root{
    --primary-500:#2563EB; --primary-700:#1E3A8A;
    --neutral-900:#0F172A; --neutral-700:#334155;
    --neutral-500:#64748B; --neutral-300:#CBD5E1;
    --neutral-200:#E2E8F0; --neutral-100:#F8FAFC; --neutral-0:#FFFFFF;
    --success-500:#16A34A; --warning-500:#EAB308; --error-500:#DC2626;
    --radius-s:8px; --radius-m:12px; --radius-l:16px;
    --space-xs:4px; --space-s:8px; --space-sm:12px; --space-m:16px; --space-l:24px;
  }
  html,body{margin:0;padding:0;background:var(--neutral-100);color:var(--neutral-900);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,system-ui,Arial,sans-serif;}

  /* ===== Frame ===== */
  .screen{
    width:390px; min-height:844px; box-sizing:border-box;
    margin:20px auto; background:var(--neutral-100);
    padding:var(--space-l); display:flex; flex-direction:column; gap:var(--space-m);
    border:1px solid var(--neutral-200); border-radius:var(--radius-l);
  }
  .title{font-size:24px; line-height:32px; font-weight:700; color:var(--neutral-900);}
  .subtitle{font-size:18px; line-height:28px; font-weight:700; color:var(--neutral-900);}
  .body{font-size:16px; line-height:24px; color:var(--neutral-700);}
  .muted{color:var(--neutral-500);}
  .badge{display:inline-flex; padding:2px 8px; border-radius:999px; font-size:12px; border:1px solid var(--neutral-200); background:#fff; color:var(--neutral-700);}
  .divider{height:1px; background:var(--neutral-200); margin:var(--space-s) 0;}

  /* ===== Components ===== */
  .btn{
    display:flex; align-items:center; justify-content:center;
    height:48px; border-radius:12px; padding:0 var(--space-l);
    font-size:16px; font-weight:600; text-decoration:none; cursor:pointer;
  }
  .btn.primary{background:var(--primary-500); color:#fff; border:1px solid var(--primary-500);}
  .btn.secondary{background:#fff; color:var(--primary-500); border:1px solid var(--primary-500);}
  .btn.ghost{background:transparent; color:var(--neutral-700); border:1px dashed var(--neutral-300);}
  .sticky-actions{margin-top:auto; display:flex; flex-direction:column; gap:12px;}

  .row{display:flex; gap:16px; align-items:center;}
  .col{display:flex; flex-direction:column; gap:8px;}
  .card{
    background:#fff; border:1px solid var(--neutral-200); border-radius:16px;
    padding:16px; display:flex; flex-direction:column; gap:8px; box-shadow:0 2px 8px rgba(0,0,0,.04);
  }
  .label{font-size:12px; line-height:16px; color:var(--neutral-700); font-weight:600;}
  .input, textarea, select{
    width:100%; border:1px solid var(--neutral-200); border-radius:12px;
    background:#fff; color:var(--neutral-900); padding:8px 12px; box-sizing:border-box;
  }

  .chips{display:flex; flex-wrap:wrap; gap:8px;}
  .chip{
    display:inline-flex; align-items:center; height:36px; padding:0 16px;
    border-radius:18px; border:1px solid var(--neutral-300); background:#fff; font-weight:600; color:var(--neutral-700);
    cursor:pointer; user-select:none;
  }
  .chip.active{border-color:var(--primary-500); box-shadow:0 0 0 2px rgba(37,99,235,.2) inset; color:var(--primary-500);}

  .provider{
    display:flex; gap:12px; align-items:flex-start; padding:12px; border:1px solid var(--neutral-200); border-radius:16px; background:#fff;
  }
  .avatar{width:48px; height:48px; border-radius:24px; background:linear-gradient(135deg,#dbeafe,#bfdbfe);}
  .prov-name{font-weight:700; color:var(--neutral-900);}
  .prov-meta{font-size:14px; color:var(--neutral-700);}
  .small{font-size:12px; color:var(--neutral-500);}
  .tag{font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid var(--neutral-200); background:#fff;}
  .saved{border-color:var(--success-500); color:var(--success-500);}
  .chat-bubble{
    background:#fff; border:1px solid var(--neutral-200); border-radius:16px; padding:12px; max-width:85%;
  }
</style>
<script>
  function go(id){ const el=document.getElementById(id); if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); } return false; }

  // demo providers
  const PROVIDERS = [
    { id:1, name:"Andrei Pop – Plumbing", rating:4.7, dist:2.1, cost:"150–250 RON", bio:"10+ yrs, kitchen & bathroom leaks, PFA.", exp:"10 yrs", saved:false },
    { id:2, name:"Mesterul Mihai", rating:4.5, dist:3.4, cost:"120–200 RON", bio:"Fast appointments, assists with parts.", exp:"7 yrs", saved:false },
    { id:3, name:"Cluj AquaFix", rating:4.9, dist:5.0, cost:"180–300 RON", bio:"Small team, invoice & warranty.", exp:"12 yrs", saved:false }
  ];
  const State = {
    category: "Plumbing",
    filters: { maxDist: null, minRating: null, maxCost: null },
    saved: [],
    selectedForChat: null
  };

  function renderProviders(listId, options = {}) {
    const wrap = document.getElementById(listId);
    if(!wrap) return;
    wrap.innerHTML = '';
    let list = PROVIDERS.slice();

    // apply filters if requested
    if(options.filter){
      list = list.filter(p=>{
        const passDist  = !State.filters.maxDist   || p.dist <= State.filters.maxDist;
        const passRate  = !State.filters.minRating || p.rating >= State.filters.minRating;
        // cost is string; do a simple contains compare
        const passCost  = !State.filters.maxCost   || p.cost.indexOf(State.filters.maxCost) >= 0;
        return passDist && passRate && passCost;
      });
    }

    list.forEach(p=>{
      const div = document.createElement('div');
      div.className = 'provider';
      div.innerHTML = `
        <div class="avatar" aria-hidden="true"></div>
        <div style="flex:1;">
          <div class="row" style="justify-content:space-between; align-items:flex-start;">
            <div class="col" style="gap:2px;">
              <div class="prov-name">${p.name}</div>
              <div class="prov-meta">★ ${p.rating.toFixed(1)} • ${p.dist} km • ${p.cost}</div>
              <div class="small">${p.bio}</div>
            </div>
            <div class="col" style="gap:6px; align-items:flex-end;">
              <span class="tag ${p.saved ? 'saved' : ''}">${p.saved ? 'Saved' : 'Not saved'}</span>
              <a class="btn ghost" data-id="${p.id}">Details</a>
            </div>
          </div>
        </div>
      `;
      wrap.appendChild(div);
    });

    // bind details to go to compare screen
    wrap.querySelectorAll('a.btn.ghost').forEach(a=>{
      a.addEventListener('click', e=>{
        e.preventDefault();
        const id = +a.getAttribute('data-id');
        State.selectedForChat = PROVIDERS.find(p=>p.id===id) || null;
        fillCompare();
        go('03_Compare_Bios');
      });
    });
  }

  function selectCategory(el, value){
    document.querySelectorAll('#catChips .chip').forEach(c=>c.classList.remove('active'));
    el.classList.add('active');
    State.category = value;
  }

  function applyFilters(){
    // read values
    const distSel = document.getElementById('filterDist');
    const ratingSel = document.getElementById('filterRating');
    const costSel = document.getElementById('filterCost');

    State.filters.maxDist = distSel && distSel.value ? parseFloat(distSel.value) : null;
    State.filters.minRating = ratingSel && ratingSel.value ? parseFloat(ratingSel.value) : null;
    State.filters.maxCost = costSel && costSel.value ? costSel.value : null;

    renderProviders('filteredList', {filter:true});
  }

  function fillCompare(){
    const box = document.getElementById('compareList');
    if(!box) return;
    box.innerHTML = '';
    PROVIDERS.forEach(p=>{
      const c = document.createElement('div');
      c.className = 'card';
      c.innerHTML = `
        <div class="row" style="justify-content:space-between;">
          <div class="col" style="gap:2px;">
            <div class="label">${p.name}</div>
            <div class="body muted">${p.exp} • ${p.dist} km</div>
          </div>
          <div class="badge">★ ${p.rating.toFixed(1)}</div>
        </div>
        <div class="body">${p.bio}</div>
        <div class="row" style="gap:8px;">
          <a class="btn ghost" data-id="${p.id}">${p.saved ? 'Unsave' : 'Save'}</a>
          <span class="badge">${p.cost}</span>
        </div>
      `;
      box.appendChild(c);
    });
    // bind save
    box.querySelectorAll('a.btn.ghost').forEach(a=>{
      a.addEventListener('click', e=>{
        e.preventDefault();
        const id = +a.getAttribute('data-id');
        toggleSave(id);
      });
    });
  }

  function toggleSave(id){
    const p = PROVIDERS.find(p=>p.id===id);
    if(!p) return;
    p.saved = !p.saved;
    // recompute saved
    State.saved = PROVIDERS.filter(p=>p.saved).map(p=>p.id);
    fillCompare();
    renderSaved();
  }

  function renderSaved(){
    const box = document.getElementById('savedList');
    if(!box) return;
    box.innerHTML = '';
    const savedProviders = PROVIDERS.filter(p=>p.saved);
    savedProviders.forEach(p=>{
      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <div class="row" style="justify-content:space-between;">
          <div class="col" style="gap:2px;">
            <div class="label">${p.name}</div>
            <div class="body muted">${p.cost} • ★ ${p.rating.toFixed(1)}</div>
          </div>
          <span class="badge saved">Saved</span>
        </div>
      `;
      box.appendChild(card);
    });
    if(!savedProviders.length){
      box.innerHTML = '<div class="body muted">No saved plumbers yet. Choose 2 to continue.</div>';
    }
  }

  function openMessage(){
    // pick first saved as recipient, fallback to selected
    const saved = PROVIDERS.filter(p=>p.saved);
    const target = saved[0] || State.selectedForChat || PROVIDERS[0];
    const rec = document.getElementById('msgRecipient');
    if(rec) rec.textContent = target ? target.name : 'Plumber';
    go('05_Message_Clarify');
  }

  function confirmBooking(){
    // show confirm screen with saved providers
    const list = document.getElementById('confSaved');
    if(list){
      list.innerHTML = '';
      const saved = PROVIDERS.filter(p=>p.saved);
      saved.forEach(p=>{
        const li = document.createElement('div');
        li.className = 'row';
        li.innerHTML = `<div class="badge saved">${p.name}</div>`;
        list.appendChild(li);
      });
      if(!saved.length){
        list.innerHTML = '<div class="body muted">No saved providers, booking with last contacted.</div>';
      }
    }
    go('06_Confirm_Booking');
  }

  window.addEventListener('load', () => {
    renderProviders('filteredList'); // initial list
  });
</script>
</head>
<body>

<!-- 00 Context -->
<section class="screen" id="00_Context_SearchCompare">
  <div class="title">Search & Compare Plumbers</div>
  <div class="card">
    <div class="subtitle">Purpose & Motivation</div>
    <div class="body">Resolve a slow kitchen leak at a convenient time and fair price.</div>
    <div class="divider"></div>
    <div class="row" style="flex-wrap:wrap; gap:8px;">
      <span class="badge">Context: Calm, daytime/weekend planning</span>
      <span class="badge">Starting point: Logged in, exploring categories</span>
      <span class="badge">Decision: comparison-based</span>
    </div>
  </div>
  <div class="card">
    <div class="label">Flow steps</div>
    <ol class="body">
      <li>Choose plumbing category</li>
      <li>Filter by distance/rating/cost</li>
      <li>Compare bios & experience</li>
      <li>Save two candidates</li>
      <li>Message to clarify schedule</li>
      <li>Confirm booking</li>
    </ol>
  </div>
  <div class="sticky-actions">
    <a href="#01_Choose_Plum_Category" class="btn primary" onclick="return go('01_Choose_Plum_Category')">Start</a>
  </div>
</section>

<!-- 01 Choose plumbing category -->
<section class="screen" id="01_Choose_Plum_Category">
  <div class="title">Plumbing services</div>
  <div class="body muted">Pick the related issue</div>

  <div id="catChips" class="chips">
    <span class="chip active" onclick="selectCategory(this,'Kitchen leak')">Kitchen leak</span>
    <span class="chip" onclick="selectCategory(this,'Bathroom leak')">Bathroom leak</span>
    <span class="chip" onclick="selectCategory(this,'Clogged drain')">Clogged drain</span>
    <span class="chip" onclick="selectCategory(this,'Pipe inspection')">Pipe inspection</span>
  </div>

  <div class="card">
    <div class="label">Your selection</div>
    <div class="body muted">Non-urgent, can be scheduled.</div>
  </div>

  <div class="sticky-actions">
    <a href="#02_Filter_Providers" class="btn primary" onclick="return go('02_Filter_Providers')">Next: filter providers</a>
    <a href="#00_Context_SearchCompare" class="btn secondary" onclick="return go('00_Context_SearchCompare')">Back</a>
  </div>
</section>

<!-- 02 Filter providers -->
<section class="screen" id="02_Filter_Providers">
  <div class="title">Filter plumbers</div>
  <div class="body muted">Narrow down by distance, rating, and cost estimate.</div>

  <div class="card">
    <div class="label">Distance (km)</div>
    <select id="filterDist" class="input" onchange="applyFilters()">
      <option value="">Any</option>
      <option value="3">≤ 3 km</option>
      <option value="5">≤ 5 km</option>
      <option value="10">≤ 10 km</option>
    </select>
  </div>

  <div class="card">
    <div class="label">Min rating</div>
    <select id="filterRating" class="input" onchange="applyFilters()">
      <option value="">Any</option>
      <option value="4.5">4.5+</option>
      <option value="4.7">4.7+</option>
      <option value="4.9">4.9+</option>
    </select>
  </div>

  <div class="card">
    <div class="label">Cost estimate</div>
    <select id="filterCost" class="input" onchange="applyFilters()">
      <option value="">Any</option>
      <option value="120">120–200 RON</option>
      <option value="150">150–250 RON</option>
      <option value="180">180–300 RON</option>
    </select>
  </div>

  <div id="filteredList" class="col"><!-- providers injected here --></div>

  <div class="sticky-actions">
    <a href="#03_Compare_Bios" class="btn primary" onclick="fillCompare(); return go('03_Compare_Bios')">Compare</a>
    <a href="#01_Choose_Plum_Category" class="btn secondary" onclick="return go('01_Choose_Plum_Category')">Back</a>
  </div>
</section>

<!-- 03 Compare short bios and experience -->
<section class="screen" id="03_Compare_Bios">
  <div class="title">Compare plumbers</div>
  <div class="body muted">Read short bios & pick the best 2.</div>

  <div id="compareList" class="col"><!-- filled by JS --></div>

  <div class="sticky-actions">
    <a href="#04_Save_Preferred" class="btn primary" onclick="renderSaved(); return go('04_Save_Preferred')">Save 2 preferred</a>
    <a href="#02_Filter_Providers" class="btn secondary" onclick="return go('02_Filter_Providers')">Back</a>
  </div>
</section>

<!-- 04 Save two preferred candidates -->
<section class="screen" id="04_Save_Preferred">
  <div class="title">Saved plumbers</div>
  <div class="body muted">We recommend saving 2 so you can compare schedules.</div>

  <div id="savedList" class="col"><!-- filled by JS --></div>

  <div class="sticky-actions">
    <a href="#05_Message_Clarify" class="btn primary" onclick="openMessage(); return false;">Message to clarify</a>
    <a href="#03_Compare_Bios" class="btn secondary" onclick="return go('03_Compare_Bios')">Back</a>
  </div>
</section>

<!-- 05 Initiate a message -->
<section class="screen" id="05_Message_Clarify">
  <div class="title">Message plumber</div>
  <div class="body muted">Ask about availability (Sat morning, lunch break, etc.).</div>

  <div class="card">
    <div class="label">To</div>
    <div class="body" id="msgRecipient">Plumber</div>
  </div>

  <div class="card">
    <div class="label">Your message</div>
    <textarea placeholder="Hi! I have a slow leak under the kitchen sink. Are you available this weekend or after 18:00 on weekdays?"></textarea>
  </div>

  <div class="card">
    <div class="label">Conversation</div>
    <div class="chat-bubble"><b>You:</b> Hi, I’d like to fix a slow leak at a convenient time.</div>
    <div class="chat-bubble" style="margin-left:40px; background:#eff6ff; border-color:#dbeafe;"><b>Plumber:</b> Hello! I can come Saturday morning, 10–11. Does that work?</div>
  </div>

  <div class="sticky-actions">
    <a href="#06_Confirm_Booking" class="btn primary" onclick="confirmBooking(); return false;">Confirm booking</a>
    <a href="#04_Save_Preferred" class="btn secondary" onclick="return go('04_Save_Preferred')">Back</a>
  </div>
</section>

<!-- 06 Confirm final booking -->
<section class="screen" id="06_Confirm_Booking">
  <div class="title">Booking confirmed ✅</div>
  <div class="body muted">We saved the appointment details. You can still switch to your second choice.</div>

  <div class="card">
    <div class="label">Saved candidates</div>
    <div id="confSaved" class="col">
      <!-- filled by JS -->
    </div>
  </div>

  <div class="card">
    <div class="label">Appointment</div>
    <div class="body">Kitchen sink leak</div>
    <div class="body muted">Scheduled: Saturday 10:00–11:00 (proposed)</div>
  </div>

  <div class="sticky-actions">
    <a href="#00_Context_SearchCompare" class="btn primary" onclick="return go('00_Context_SearchCompare')">Back to flow context</a>
  </div>
</section>

</body>
</html>